<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>XamIQ | Nexus Admin v10</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --accent: #007AFF; --red: #FF3B30; --bg: #000000; --card: #0A0A0A; --border: rgba(255,255,255,0.06); }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: #fff; overflow: hidden; height: 100vh; margin: 0; }
        
        .tab-section { display: none !important; }
        .tab-section.active-view { display: block !important; }

        .glass { background: rgba(8, 8, 8, 0.98); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border-top: 1px solid var(--border); }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; transition: 0.2s; }
        
        /* Navigation Highlighting */
        .nav-link { color: #444; transition: 0.3s; }
        .nav-link.active-nav { color: var(--accent) !important; background: rgba(0, 122, 255, 0.1); border-radius: 14px; }
        .nav-link.active-nav i { color: var(--accent); transform: scale(1.1); }

        /* Compact Styling */
        input, select, textarea { background: #111 !important; border: 1px solid #222 !important; color: white !important; padding: 10px 14px !important; border-radius: 12px !important; font-size: 13px; font-weight: 600; outline: none !important; width: 100%; }
        input:focus { border-color: var(--accent) !important; }
        label { font-size: 9px; font-weight: 800; color: #555; margin-bottom: 3px; display: block; text-transform: uppercase; letter-spacing: 0.05em; margin-left: 5px; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .select-text { user-select: text !important; }

        @media (max-width: 768px) {
            .sidebar-desktop { display: none !important; }
            .modal-content { height: 100%; border-radius: 0; padding: 20px; }
        }
        @media (min-width: 769px) {
            .bottom-nav { display: none; }
            .sidebar-desktop { width: 260px; border-right: 1px solid var(--border); padding: 30px; display: flex; flex-direction: column; }
        }
    </style>
</head>
<body class="flex flex-col md:flex-row h-screen">

    <!-- 1. AUTH SCREEN -->
    <div id="auth-screen" class="fixed inset-0 z-[2000] bg-black flex items-center justify-center p-6">
        <div class="w-full max-w-sm text-center">
            <div class="w-16 h-16 bg-blue-600/10 rounded-2xl flex items-center justify-center mx-auto mb-6 border border-blue-500/20">
                <i data-lucide="shield-check" class="text-blue-500 w-8 h-8"></i>
            </div>
            <h1 class="text-3xl font-black italic tracking-tighter mb-1">XamIQ <span class="text-blue-500">PRO</span></h1>
            <p class="text-[8px] font-black uppercase text-neutral-700 tracking-[0.3em] mb-10">Admin Control v10</p>
            <div class="space-y-3">
                <input type="email" id="email" placeholder="Admin Email" class="text-center">
                <input type="password" id="password" placeholder="Password" class="text-center">
                <button onclick="Nexus.login()" id="login-btn" class="w-full py-4 bg-blue-600 rounded-2xl font-bold uppercase tracking-widest text-[10px] shadow-lg active:scale-95">Verify Identity</button>
            </div>
        </div>
    </div>

    <!-- 2. SIDEBAR (DESKTOP) -->
    <aside class="sidebar-desktop bg-[#050505] h-full">
        <div class="font-black text-2xl italic tracking-tighter mb-12"><span class="text-white">Xam</span><span class="text-blue-500">IQ</span></div>
        <nav class="flex-1 space-y-1">
            <button onclick="Nexus.switchTab('overview')" class="nav-link w-full flex items-center gap-4 p-4 text-[10px] font-black uppercase tracking-widest active-nav" data-tab="overview"><i data-lucide="layout-grid" class="w-4 h-4"></i> Overview</button>
            <button onclick="Nexus.switchTab('requests')" class="nav-link w-full flex items-center gap-4 p-4 text-[10px] font-black uppercase tracking-widest" data-tab="requests"><i data-lucide="users" class="w-4 h-4"></i> Batch Requests</button>
            <button onclick="Nexus.switchTab('courses')" class="nav-link w-full flex items-center gap-4 p-4 text-[10px] font-black uppercase tracking-widest" data-tab="courses"><i data-lucide="book-open" class="w-4 h-4"></i> Library</button>
            <button onclick="Nexus.switchTab('posters')" class="nav-link w-full flex items-center gap-4 p-4 text-[10px] font-black uppercase tracking-widest" data-tab="posters"><i data-lucide="image" class="w-4 h-4"></i> Banners</button>
            <button onclick="Nexus.switchTab('alerts')" class="nav-link w-full flex items-center gap-4 p-4 text-[10px] font-black uppercase tracking-widest" data-tab="alerts"><i data-lucide="bell" class="w-4 h-4"></i> Alerts</button>
        </nav>
        <button onclick="Nexus.logout()" class="p-4 rounded-xl bg-red-600/5 text-red-500 font-bold text-[9px] uppercase flex items-center justify-center gap-2"><i data-lucide="power" class="w-3 h-3"></i> Shutdown</button>
    </aside>

    <!-- 3. MAIN APP -->
    <div id="main-app" class="hidden flex-1 flex flex-col overflow-hidden relative">
        <header class="p-6 flex justify-between items-center border-b border-white/5 bg-black/50 backdrop-blur-xl sticky top-0 z-[100]">
            <div class="flex flex-col">
                <h2 id="view-title" class="text-lg font-black uppercase italic tracking-tighter">Overview</h2>
                <span class="text-[7px] text-blue-500 font-black uppercase tracking-widest italic">Connected to Cloud</span>
            </div>
            <div id="header-action"></div>
        </header>

        <main class="flex-1 overflow-y-auto no-scrollbar p-4 md:p-10 pb-32">
            <!-- OVERVIEW SECTION -->
            <section id="view-overview" class="tab-section active-view space-y-4">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                    <div class="card p-6 border-blue-500/10">
                        <p class="text-[8px] font-black text-neutral-500 uppercase tracking-widest mb-1">Live Students</p>
                        <h3 id="stat-users" class="text-3xl font-black italic tracking-tighter">486<span class="text-blue-500">+</span></h3>
                    </div>
                    <div class="card p-6 border-white/5">
                        <p class="text-[8px] font-black text-neutral-500 uppercase tracking-widest mb-1">Courses</p>
                        <h3 id="stat-courses" class="text-3xl font-black italic tracking-tighter text-blue-500">0</h3>
                    </div>
                    <div class="card p-6 border-white/5 col-span-2 md:col-span-1">
                        <p class="text-[8px] font-black text-neutral-500 uppercase tracking-widest mb-1">Join Requests</p>
                        <h3 id="stat-subs" class="text-3xl font-black italic tracking-tighter text-red-500">0</h3>
                    </div>
                </div>
            </section>

            <!-- DATA VIEWS -->
            <section id="view-requests" class="tab-section space-y-3"></section>
            <section id="view-courses" class="tab-section grid grid-cols-1 md:grid-cols-3 gap-4"></section>
            <section id="view-posters" class="tab-section grid grid-cols-1 md:grid-cols-2 gap-4"></section>
            <section id="view-alerts" class="tab-section space-y-3"></section>
        </main>

        <!-- BOTTOM NAV (MOBILE) -->
        <nav class="bottom-nav glass fixed bottom-0 left-0 right-0 h-20 flex items-center justify-around z-50">
            <button onclick="Nexus.switchTab('overview')" class="nav-link flex flex-col items-center gap-1 active-nav" data-tab-mobile="overview"><i data-lucide="layout-grid" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Home</span></button>
            <button onclick="Nexus.switchTab('requests')" class="nav-link flex flex-col items-center gap-1" data-tab-mobile="requests"><i data-lucide="users" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Batch</span></button>
            <button onclick="Nexus.switchTab('courses')" class="nav-link flex flex-col items-center gap-1" data-tab-mobile="courses"><i data-lucide="book-open" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Library</span></button>
            <button onclick="Nexus.switchTab('posters')" class="nav-link flex flex-col items-center gap-1" data-tab-mobile="posters"><i data-lucide="image" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Banner</span></button>
            <button onclick="Nexus.switchTab('alerts')" class="nav-link flex flex-col items-center gap-1" data-tab-mobile="alerts"><i data-lucide="bell" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Alert</span></button>
        </nav>
    </div>

    <!-- GLOBAL CONSOLE MODAL -->
    <div id="data-modal" class="fixed inset-0 z-[1000] bg-black/98 hidden items-center justify-center p-0 md:p-6 backdrop-blur-xl">
        <div class="modal-content w-full max-w-lg card p-8 relative flex flex-col border-white/10">
            <button onclick="Nexus.closeModal()" class="absolute top-8 right-8 text-neutral-500"><i data-lucide="x" class="w-5 h-5"></i></button>
            <h3 id="modal-head" class="text-2xl font-black uppercase italic mb-8 tracking-tighter">Nexus Console</h3>
            
            <div id="modal-form" class="space-y-4 flex-1 overflow-y-auto no-scrollbar">
                <!-- Group Course -->
                <div id="group-course" class="hidden space-y-3">
                    <div><label>Course Title</label><input id="c-name" placeholder="Title"></div>
                    <div><label>Instructor</label><input id="c-instr" placeholder="Teacher Name"></div>
                    <div><label>Thumbnail URL</label><input id="c-thumb" placeholder="https://..."></div>
                    <div><label>Streaming/Web Link</label><input id="c-link" placeholder="Embed URL"></div>
                    <div><label>Batch Group</label><select id="c-cat"><option>Physics</option><option>Chemistry</option><option>Maths</option><option>General Studies</option><option>Premium</option></select></div>
                </div>
                <!-- Group Poster -->
                <div id="group-poster" class="hidden space-y-3">
                    <div><label>Banner Headline</label><input id="s-title" placeholder="Ad Title"></div>
                    <div><label>Image Link (16:9)</label><input id="s-img" placeholder="Poster Link"></div>
                    <div><label>Redirect URL</label><input id="s-red" placeholder="Action Link"></div>
                </div>
                <!-- Group Alert -->
                <div id="group-alert" class="hidden space-y-3">
                    <div><label>Alert Headline</label><input id="a-title" placeholder="Update Title"></div>
                    <div><label>Message Detail</label><textarea id="a-msg" placeholder="..." class="w-full h-32 bg-[#111] border border-[#222] rounded-xl p-4 text-[13px] font-bold text-white"></textarea></div>
                    <div><label>Redirect Link</label><input id="a-link" placeholder="Optional URL"></div>
                </div>
            </div>
            <button id="modal-save-btn" class="w-full py-5 bg-blue-600 rounded-2xl font-black uppercase text-[10px] tracking-widest mt-8 shadow-xl shadow-blue-500/20 active:scale-95 transition-all">Apply to Cloud</button>
        </div>
    </div>

    <!-- CORE LOGIC (FIREBASE V10) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, updateDoc, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAqMcBaKizRjg668AUM6CNWGYEJr5Ncd58",
            authDomain: "banty-live.firebaseapp.com",
            projectId: "banty-live",
            storageBucket: "banty-live.firebasestorage.app",
            messagingSenderId: "435477036444",
            appId: "1:435477036444:web:3340a16fd29c4e4f269c59"
        };

        const fb = initializeApp(firebaseConfig);
        const db = getFirestore(fb);
        const auth = getAuth(fb);

        window.Nexus = {
            activeId: null, activeCol: null,

            login: async () => {
                const e = document.getElementById('email').value;
                const p = document.getElementById('password').value;
                const btn = document.getElementById('login-btn');
                if(!e || !p) return;
                btn.innerText = "AUTHENTICATING...";
                try { await signInWithEmailAndPassword(auth, e, p); } catch(err) { alert("DENIED: Restricted Access"); btn.innerText = "Login System"; }
            },

            logout: () => signOut(auth),

            switchTab: (tabId) => {
                document.querySelectorAll('.tab-section').forEach(s => s.classList.remove('active-view'));
                document.getElementById(`view-${tabId}`).classList.add('active-view');
                
                document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active-nav'));
                document.querySelectorAll(`[data-tab="${tabId}"]`).forEach(el => el.classList.add('active-nav'));
                document.querySelectorAll(`[data-tab-mobile="${tabId}"]`).forEach(el => el.classList.add('active-nav'));
                
                document.getElementById('view-title').innerText = tabId.toUpperCase();
                
                const act = document.getElementById('header-action');
                act.innerHTML = '';
                if(tabId === 'courses') act.innerHTML = `<button onclick="Nexus.openCourseModal()" class="px-4 py-2 bg-blue-600 rounded-xl text-[9px] font-black uppercase">+ Course</button>`;
                if(tabId === 'posters') act.innerHTML = `<button onclick="Nexus.openPosterModal()" class="px-4 py-2 bg-blue-600 rounded-xl text-[9px] font-black uppercase">+ Poster</button>`;
                if(tabId === 'alerts') act.innerHTML = `<button onclick="Nexus.openAlertModal()" class="px-4 py-2 bg-red-600 rounded-xl text-[9px] font-black uppercase">+ Alert</button>`;
                lucide.createIcons();
            },

            closeModal: () => document.getElementById('data-modal').classList.add('hidden'),

            resetForm: () => {
                document.getElementById('group-course').classList.add('hidden');
                document.getElementById('group-poster').classList.add('hidden');
                document.getElementById('group-alert').classList.add('hidden');
            },

            // Specialized Modal Logics
            openCourseModal: (data = null) => {
                Nexus.resetForm(); Nexus.activeCol = 'courses'; Nexus.activeId = data ? data.id : null;
                document.getElementById('modal-head').innerText = data ? "Edit Course" : "Add Course";
                document.getElementById('group-course').classList.remove('hidden');
                if(data) {
                    document.getElementById('c-name').value = data.name;
                    document.getElementById('c-instr').value = data.instructor;
                    document.getElementById('c-thumb').value = data.thumbnail;
                    document.getElementById('c-link').value = data.link;
                    document.getElementById('c-cat').value = data.category;
                } else {
                    document.querySelectorAll('#group-course input').forEach(i => i.value = '');
                }
                document.getElementById('modal-save-btn').onclick = Nexus.saveData;
                document.getElementById('data-modal').classList.remove('hidden');
            },

            openPosterModal: (data = null) => {
                Nexus.resetForm(); Nexus.activeCol = 'sliders'; Nexus.activeId = data ? data.id : null;
                document.getElementById('modal-head').innerText = data ? "Update Banner" : "New Banner";
                document.getElementById('group-poster').classList.remove('hidden');
                if(data) {
                    document.getElementById('s-title').value = data.title;
                    document.getElementById('s-img').value = data.image;
                    document.getElementById('s-red').value = data.redirect;
                } else {
                    document.querySelectorAll('#group-poster input').forEach(i => i.value = '');
                }
                document.getElementById('modal-save-btn').onclick = Nexus.saveData;
                document.getElementById('data-modal').classList.remove('hidden');
            },

            openAlertModal: () => {
                Nexus.resetForm(); Nexus.activeCol = 'alerts'; Nexus.activeId = null;
                document.getElementById('modal-head').innerText = "Broadcast Alert";
                document.getElementById('group-alert').classList.remove('hidden');
                document.querySelectorAll('#group-alert input, #group-alert textarea').forEach(i => i.value = '');
                document.getElementById('modal-save-btn').onclick = Nexus.saveData;
                document.getElementById('data-modal').classList.remove('hidden');
            },

            saveData: async () => {
                const btn = document.getElementById('modal-save-btn');
                btn.innerText = "UPLOADING DATA...";
                let payload = { timestamp: new Date().toISOString() };
                try {
                    if(Nexus.activeCol === 'courses') {
                        payload = { ...payload, name: document.getElementById('c-name').value, instructor: document.getElementById('c-instr').value, thumbnail: document.getElementById('c-thumb').value, link: document.getElementById('c-link').value, category: document.getElementById('c-cat').value };
                    } else if(Nexus.activeCol === 'sliders') {
                        payload = { ...payload, title: document.getElementById('s-title').value, image: document.getElementById('s-img').value, redirect: document.getElementById('s-red').value };
                    } else if(Nexus.activeCol === 'alerts') {
                        payload = { ...payload, title: document.getElementById('a-title').value, message: document.getElementById('a-msg').value, link: document.getElementById('a-link').value };
                    }
                    if(Nexus.activeId) await updateDoc(doc(db, Nexus.activeCol, Nexus.activeId), payload);
                    else await addDoc(collection(db, Nexus.activeCol), payload);
                    Nexus.closeModal();
                } catch(e) { alert("PERMISSION DENIED"); }
                btn.innerText = "Apply to Cloud";
            },

            deleteItem: async (col, id) => {
                if(confirm("Confirm deletion?")) await deleteDoc(doc(db, col, id));
            }
        };

        // --- Real-time Node Logic ---
        onAuthStateChanged(auth, u => {
            if(u) {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                Nexus.switchTab('overview');
                
                // 1. Batch Requests Sync (ADVANCED UI)
                onSnapshot(query(collection(db, 'submissions'), orderBy('timestamp', 'desc')), snap => {
                    const div = document.getElementById('view-requests');
                    document.getElementById('stat-subs').innerText = snap.size;
                    div.innerHTML = '';
                    snap.forEach(d => {
                        const s = d.data();
                        
                        // Data formatting for requests
                        let requestData = '';
                        if(s.token) {
                            requestData = `<div class="bg-blue-600/10 p-3 rounded-xl mt-3 border border-blue-500/20"><p class="text-[9px] font-black text-blue-500 uppercase mb-1">ACCESS VIA TOKEN</p><p class="text-lg font-black text-white select-text">${s.token}</p></div>`;
                        } else {
                            requestData = `<div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-3"><div class="bg-white/5 p-3 rounded-xl border border-white/5"><p class="text-[8px] font-black text-neutral-500 uppercase mb-1">ID / PHONE / EMAIL</p><p class="text-sm font-bold text-white select-text">${s.identifier || 'N/A'}</p></div><div class="bg-white/5 p-3 rounded-xl border border-white/5"><p class="text-[8px] font-black text-neutral-500 uppercase mb-1">PASSWORD / KEY</p><p class="text-sm font-bold text-red-500 select-text">${s.password || 'N/A'}</p></div></div>`;
                        }

                        div.innerHTML += `
                        <div class="card p-6 flex flex-col group">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="flex items-center gap-2 mb-2"><span class="bg-blue-600 text-[8px] font-black px-2 py-1 rounded-full uppercase tracking-widest">${s.batch}</span><span class="text-[8px] opacity-30 font-black uppercase"><i data-lucide="calendar" class="w-3 h-3 inline"></i> ${new Date(s.timestamp).toLocaleDateString()} at ${new Date(s.timestamp).toLocaleTimeString()}</span></div>
                                    <h4 class="text-xl font-black italic tracking-tighter text-blue-500 uppercase italic">From: ${s.userName}</h4>
                                </div>
                                <button onclick="Nexus.deleteItem('submissions', '${d.id}')" class="text-red-500 p-3 bg-red-600/5 rounded-2xl border border-red-500/10 active:scale-90 transition-all"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                            </div>
                            ${requestData}
                        </div>`;
                    });
                    lucide.createIcons();
                });

                // 2. Library Sync
                onSnapshot(collection(db, 'courses'), snap => {
                    const div = document.getElementById('view-courses');
                    document.getElementById('stat-courses').innerText = snap.size;
                    div.innerHTML = '';
                    snap.forEach(d => {
                        const c = d.data();
                        div.innerHTML += `
                        <div class="card overflow-hidden">
                            <img src="${c.thumbnail}" class="w-full aspect-video object-cover border-b border-white/5">
                            <div class="p-5">
                                <span class="text-[8px] font-black text-blue-500 uppercase">${c.category}</span>
                                <h4 class="font-bold text-base uppercase truncate mb-4">${c.name}</h4>
                                <div class="flex gap-2">
                                    <button onclick='Nexus.openCourseModal(${JSON.stringify({...c, id: d.id}).replace(/'/g, "&apos;")})' class="flex-1 py-2 bg-white/5 rounded-xl text-[9px] font-black uppercase border border-white/10">Update</button>
                                    <button onclick="Nexus.deleteItem('courses', '${d.id}')" class="p-2 bg-red-600/10 text-red-500 rounded-xl"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                </div>
                            </div>
                        </div>`;
                    });
                    lucide.createIcons();
                });

                // 3. Banner Sync
                onSnapshot(collection(db, 'sliders'), snap => {
                    const div = document.getElementById('view-posters');
                    div.innerHTML = '';
                    snap.forEach(d => {
                        const s = d.data();
                        div.innerHTML += `
                        <div class="card overflow-hidden h-44 relative group">
                            <img src="${s.image}" class="w-full h-full object-cover opacity-60">
                            <div class="absolute inset-0 p-5 flex flex-col justify-end">
                                <h4 class="text-xs font-black uppercase italic tracking-tighter">${s.title}</h4>
                                <p class="text-[8px] opacity-40 font-bold truncate w-48 mb-4">${s.redirect || 'Direct Action'}</p>
                                <div class="flex gap-2">
                                    <button onclick='Nexus.openPosterModal(${JSON.stringify({...s, id: d.id}).replace(/'/g, "&apos;")})' class="flex-1 py-2 bg-white/10 backdrop-blur-md rounded-xl text-[8px] font-black uppercase">Edit Poster</button>
                                    <button onclick="Nexus.deleteItem('sliders', '${d.id}')" class="p-2 bg-red-600 text-white rounded-xl"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                </div>
                            </div>
                        </div>`;
                    });
                    lucide.createIcons();
                });

                // 4. Alert Sync
                onSnapshot(query(collection(db, 'alerts'), orderBy('timestamp', 'desc')), snap => {
                    const div = document.getElementById('view-alerts');
                    div.innerHTML = '';
                    snap.forEach(d => {
                        const a = d.data();
                        div.innerHTML += `<div class="card p-6 flex justify-between items-center group"><div><h4 class="text-[9px] font-black text-red-500 uppercase mb-2 italic">${a.title}</h4><p class="text-[14px] font-bold opacity-60 leading-relaxed">${a.message}</p></div><button onclick="Nexus.deleteItem('alerts', '${d.id}')" class="text-red-500 opacity-0 group-hover:opacity-100 transition-all"><i data-lucide="trash-2" class="w-5 h-5"></i></button></div>`;
                    });
                    lucide.createIcons();
                });

                // 5. Total Users Observer
                onSnapshot(collection(db, 'users'), s => { if(s.size > 0) document.getElementById('stat-users').innerText = s.size; });
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }
        });
        lucide.createIcons();
    </script>
</body>
</html>