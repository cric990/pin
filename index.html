<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XamIQ | Master Console</title>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0/client",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"
      }
    }
    </script>
</head>
<body class="bg-slate-900 text-white font-sans">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from 'firebase/firestore';
        import { getAuth, signInWithRedirect, GoogleAuthProvider, getRedirectResult, onAuthStateChanged, signOut } from 'firebase/auth';

        const firebaseConfig = {
          apiKey: "AIzaSyA2iHrUt8_xxvB2m8-LftaE9fTjVj_E_3Y",
          authDomain: "banty-live.firebaseapp.com",
          projectId: "banty-live",
          storageBucket: "banty-live.firebasestorage.app",
          messagingSenderId: "435477036444",
          appId: "1:435477036444:web:3858e75d51aacba1269c59"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        const App = () => {
            const [user, setUser] = useState(null);
            const [role, setRole] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                getRedirectResult(auth).then(() => {
                    onAuthStateChanged(auth, async (u) => {
                        if (u) {
                            setUser(u);
                            const userRef = doc(db, "users", u.uid);
                            const d = await getDoc(userRef);
                            
                            if (d.exists()) {
                                setRole(d.data().role);
                            } else {
                                // Agar ID nahi hai toh create kar do
                                await setDoc(userRef, { 
                                    name: u.displayName, 
                                    email: u.email, 
                                    uid: u.uid, 
                                    role: 'student',
                                    createdAt: serverTimestamp() 
                                });
                                setRole('student');
                            }
                        }
                        setLoading(false);
                    });
                });
            }, []);

            if (loading) return <div className="h-screen flex items-center justify-center">Loading Cloud...</div>;

            if (!user) return (
                <div className="h-screen flex flex-col items-center justify-center gap-6">
                    <h1 className="text-3xl font-black italic">XamIQ ADMIN</h1>
                    <button onClick={() => signInWithRedirect(auth, new GoogleAuthProvider())} className="bg-white text-black px-10 py-4 rounded-2xl font-bold">Sign in with Google</button>
                </div>
            );

            if (role !== 'admin') return (
                <div className="h-screen flex flex-col items-center justify-center p-10 text-center">
                    <div className="bg-red-600 p-6 rounded-full mb-6">⚠️</div>
                    <h1 className="text-2xl font-bold mb-4">ACCESS DENIED</h1>
                    <p className="text-slate-400 mb-6">Aapka account admin nahi hai.</p>
                    <div className="bg-slate-800 p-4 rounded-xl font-mono text-xs text-orange-400 mb-6">
                        UID: {user.uid}
                    </div>
                    <p className="text-sm text-slate-500 mb-10">Firebase Console mein is UID par role: "admin" add karein aur Refresh karein.</p>
                    <button onClick={() => signOut(auth)} className="text-slate-400 underline">Logout</button>
                </div>
            );

            return (
                <div className="h-screen flex items-center justify-center">
                    <div className="text-center">
                        <h1 className="text-4xl font-black text-green-500">ADMIN UNLOCKED!</h1>
                        <p className="mt-4">Welcome, {user.displayName}</p>
                        <p className="text-slate-400 mt-10 italic">Yahan aapka poora dashboard khulega...</p>
                        <button onClick={() => window.location.reload()} className="mt-10 bg-orange-600 px-8 py-3 rounded-xl font-bold">Open Dashboard</button>
                    </div>
                </div>
            );
        };

        createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
